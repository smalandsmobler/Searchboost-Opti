<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Babylovesgrowth - smalandskontorsmobler.se</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
    h1 { color: #38bdf8; margin-bottom: 8px; }
    h2 { color: #7dd3fc; margin: 24px 0 12px; font-size: 1.2em; }
    .subtitle { color: #94a3b8; margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    .card { background: #1e293b; border-radius: 12px; padding: 20px; border: 1px solid #334155; }
    .card h2 { margin-top: 0; }
    label { display: block; color: #94a3b8; font-size: 0.85em; margin-bottom: 4px; margin-top: 12px; }
    input[type="text"], input[type="file"], select { width: 100%; padding: 8px 12px; background: #0f172a; border: 1px solid #475569; border-radius: 6px; color: #e2e8f0; font-size: 0.9em; }
    button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 0.9em; margin-top: 12px; }
    button:hover { background: #3b82f6; }
    button.danger { background: #dc2626; }
    button.danger:hover { background: #ef4444; }
    .result { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; margin-top: 12px; font-family: monospace; font-size: 0.8em; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    .file-list { list-style: none; }
    .file-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #334155; }
    .file-list li:last-child { border-bottom: none; }
    .file-actions button { margin-left: 8px; padding: 4px 10px; font-size: 0.8em; margin-top: 0; }
    .status { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; }
    .status.ok { background: #166534; color: #4ade80; }
    .status.err { background: #7f1d1d; color: #fca5a5; }
    .env-bar { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px 16px; margin-bottom: 20px; display: flex; gap: 12px; align-items: end; flex-wrap: wrap; }
    .env-bar label { margin: 0; }
    .env-bar input { width: 200px; }
    .env-bar button { margin-top: 0; }
    @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>Babylovesgrowth</h1>
  <p class="subtitle">smalandskontorsmobler.se - Dashboard</p>

  <div class="env-bar">
    <div>
      <label>API-nyckel (valfri)</label>
      <input type="text" id="apiKey" placeholder="Din API-nyckel">
    </div>
    <div>
      <label>API Base URL</label>
      <input type="text" id="baseUrl" value="http://localhost:3000">
    </div>
  </div>

  <div class="grid">
    <!-- UPLOAD -->
    <div class="card">
      <h2>Filuppladdning</h2>
      <label>Välj fil (bild eller PDF, max 5 MB)</label>
      <input type="file" id="fileInput" accept="image/*,.pdf">
      <button onclick="uploadFile()">Ladda upp</button>
      <div id="uploadResult" class="result" style="display:none"></div>
    </div>

    <!-- FILES -->
    <div class="card">
      <h2>Uppladdade filer</h2>
      <button onclick="listFiles()">Uppdatera lista</button>
      <select id="filterType" style="width:auto; display:inline; margin-left:8px">
        <option value="">Alla typer</option>
        <option value="png">PNG</option>
        <option value="jpg">JPG</option>
        <option value="pdf">PDF</option>
        <option value="gif">GIF</option>
        <option value="webp">WebP</option>
      </select>
      <ul id="fileList" class="file-list" style="margin-top:12px"></ul>
    </div>

    <!-- SE RANKING -->
    <div class="card">
      <h2>SE Ranking</h2>
      <button onclick="seRankingCall('/seranking/account')">Konto</button>
      <button onclick="seRankingCall('/seranking/sites')">Sajter</button>
      <div style="margin-top:12px">
        <label>Sajt-ID (för detaljer)</label>
        <input type="text" id="siteId" placeholder="t.ex. 12345">
        <button onclick="seRankingCall('/seranking/sites/' + document.getElementById('siteId').value + '/keywords')">Nyckelord</button>
        <button onclick="seRankingCall('/seranking/sites/' + document.getElementById('siteId').value + '/rankings')">Rankings</button>
        <button onclick="seRankingCall('/seranking/sites/' + document.getElementById('siteId').value + '/audit')">Audit</button>
        <button onclick="seRankingCall('/seranking/sites/' + document.getElementById('siteId').value + '/competitors')">Konkurrenter</button>
      </div>
      <div id="serankingResult" class="result" style="display:none"></div>
    </div>

    <!-- RANKMATH -->
    <div class="card">
      <h2>RankMath / WordPress</h2>
      <button onclick="rankMathCall('/rankmath/posts')">Inlägg</button>
      <button onclick="rankMathCall('/rankmath/pages')">Sidor</button>
      <button onclick="rankMathCall('/rankmath/health')">Hälsostatus</button>
      <div style="margin-top:12px">
        <label>Inläggs-ID (för SEO-meta)</label>
        <input type="text" id="postId" placeholder="t.ex. 42">
        <button onclick="rankMathCall('/rankmath/posts/' + document.getElementById('postId').value + '/seo')">Hämta SEO</button>
      </div>
      <div id="rankmathResult" class="result" style="display:none"></div>
    </div>

    <!-- GOOGLE ADS -->
    <div class="card">
      <h2>Google Ads</h2>
      <button onclick="apiCall('/googleads/campaigns', 'googleadsResult')">Kampanjer</button>
      <button onclick="apiCall('/googleads/campaigns/metrics', 'googleadsResult')">Metrics (30 dgr)</button>
      <button onclick="apiCall('/googleads/ads', 'googleadsResult')">Annonser</button>
      <div style="margin-top:12px">
        <label>Kampanj-ID</label>
        <input type="text" id="campaignId" placeholder="t.ex. 12345678">
        <button onclick="apiCall('/googleads/campaigns/' + document.getElementById('campaignId').value + '/keywords', 'googleadsResult')">Nyckelord</button>
      </div>
      <div id="googleadsResult" class="result" style="display:none"></div>
    </div>

    <!-- FACEBOOK / INSTAGRAM -->
    <div class="card">
      <h2>Facebook / Instagram</h2>
      <button onclick="apiCall('/social/facebook/insights', 'metaResult')">FB Insights</button>
      <button onclick="apiCall('/social/facebook/posts', 'metaResult')">FB Inlägg</button>
      <button onclick="apiCall('/social/instagram/account', 'metaResult')">IG Konto</button>
      <div style="margin-top:12px">
        <label>Instagram Konto-ID</label>
        <input type="text" id="igAccountId" placeholder="t.ex. 17841400...">
        <button onclick="apiCall('/social/instagram/' + document.getElementById('igAccountId').value + '/media', 'metaResult')">IG Media</button>
        <button onclick="apiCall('/social/instagram/' + document.getElementById('igAccountId').value + '/insights', 'metaResult')">IG Insights</button>
      </div>
      <div id="metaResult" class="result" style="display:none"></div>
    </div>

    <!-- LINKEDIN -->
    <div class="card">
      <h2>LinkedIn</h2>
      <button onclick="apiCall('/social/linkedin/organization', 'linkedinResult')">Organisation</button>
      <button onclick="apiCall('/social/linkedin/followers', 'linkedinResult')">Följare</button>
      <button onclick="apiCall('/social/linkedin/stats', 'linkedinResult')">Statistik</button>
      <button onclick="apiCall('/social/linkedin/posts', 'linkedinResult')">Inlägg</button>
      <div id="linkedinResult" class="result" style="display:none"></div>
    </div>
  </div>

  <script>
    function getHeaders() {
      const headers = {};
      const apiKey = document.getElementById('apiKey').value;
      if (apiKey) headers['x-api-key'] = apiKey;
      return headers;
    }

    function getBase() {
      return document.getElementById('baseUrl').value.replace(/\/$/, '');
    }

    async function uploadFile() {
      const input = document.getElementById('fileInput');
      const result = document.getElementById('uploadResult');
      if (!input.files.length) { alert('Välj en fil först'); return; }

      const form = new FormData();
      form.append('file', input.files[0]);

      result.style.display = 'block';
      result.textContent = 'Laddar upp...';

      try {
        const res = await fetch(getBase() + '/upload', {
          method: 'POST',
          headers: getHeaders(),
          body: form,
        });
        const data = await res.json();
        result.textContent = JSON.stringify(data, null, 2);
        listFiles();
      } catch (err) {
        result.textContent = 'Fel: ' + err.message;
      }
    }

    async function listFiles() {
      const list = document.getElementById('fileList');
      const type = document.getElementById('filterType').value;
      const url = getBase() + '/upload' + (type ? '?type=' + type : '');

      try {
        const res = await fetch(url, { headers: getHeaders() });
        const data = await res.json();
        list.innerHTML = '';

        if (!data.files || data.files.length === 0) {
          list.innerHTML = '<li style="color:#64748b">Inga filer uppladdade</li>';
          return;
        }

        data.files.forEach(f => {
          const li = document.createElement('li');
          const size = (f.size / 1024).toFixed(1) + ' KB';
          li.innerHTML = `
            <span>${f.filename} <span style="color:#64748b">(${size})</span></span>
            <span class="file-actions">
              <button onclick="downloadFile('${f.filename}')">Ladda ned</button>
              <button class="danger" onclick="deleteFile('${f.filename}')">Radera</button>
            </span>
          `;
          list.appendChild(li);
        });
      } catch (err) {
        list.innerHTML = '<li style="color:#fca5a5">Fel: ' + err.message + '</li>';
      }
    }

    function downloadFile(filename) {
      window.open(getBase() + '/upload/' + filename);
    }

    async function deleteFile(filename) {
      if (!confirm('Radera ' + filename + '?')) return;
      try {
        await fetch(getBase() + '/upload/' + filename, {
          method: 'DELETE',
          headers: getHeaders(),
        });
        listFiles();
      } catch (err) {
        alert('Fel: ' + err.message);
      }
    }

    async function seRankingCall(endpoint) {
      const result = document.getElementById('serankingResult');
      result.style.display = 'block';
      result.textContent = 'Hämtar...';
      try {
        const res = await fetch(getBase() + endpoint, { headers: getHeaders() });
        const data = await res.json();
        result.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        result.textContent = 'Fel: ' + err.message;
      }
    }

    async function rankMathCall(endpoint) {
      const result = document.getElementById('rankmathResult');
      result.style.display = 'block';
      result.textContent = 'Hämtar...';
      try {
        const res = await fetch(getBase() + endpoint, { headers: getHeaders() });
        const data = await res.json();
        result.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        result.textContent = 'Fel: ' + err.message;
      }
    }

    async function apiCall(endpoint, resultId) {
      const result = document.getElementById(resultId);
      result.style.display = 'block';
      result.textContent = 'Hämtar...';
      try {
        const res = await fetch(getBase() + endpoint, { headers: getHeaders() });
        const data = await res.json();
        result.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        result.textContent = 'Fel: ' + err.message;
      }
    }

    // Load file list on page load
    listFiles();
  </script>
</body>
</html>
